<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paint WP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow: hidden;
            background: #f0f0f0;
            touch-action: none;
            font-family: Arial, sans-serif;
        }

        #canvas {
            display: block;
            background: white;
            width: 100%;
            height: calc(100vh - 80px);
        }

        #controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: #333;
            display: flex;
            align-items: center;
            padding: 0 10px;
            overflow-x: auto;
        }

        .tool {
            width: 50px;
            height: 50px;
            min-width: 50px;
            background: #555;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool.active {
            background: #0078d7;
        }

        #color-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
            margin-right: 8px;
        }

        #size-slider {
            width: 80px;
            margin-right: 8px;
        }

        #color-panel {
            display: none;
            position: fixed;
            bottom: 90px;
            left: 10px;
            right: 10px;
            background: #333;
            padding: 10px;
            border-radius: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin: 5px;
            border: 2px solid #555;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="controls">
        <button class="tool active" id="brush-btn">‚úèÔ∏è</button>
        <button class="tool" id="eraser-btn">üßΩ</button>
        <button class="tool" id="line-btn">üìè</button>
        <button class="tool" id="rect-btn">‚¨õ</button>
        <button class="tool" id="circle-btn">üîµ</button>
        <div id="color-btn"></div>
        <input type="range" id="size-slider" min="1" max="30" value="5">
        <button class="tool" id="clear-btn">‚ùå</button>
    </div>

    <div id="color-panel">
        <div class="color" style="background:#000000;"></div>
        <div class="color" style="background:#FF0000;"></div>
        <div class="color" style="background:#00FF00;"></div>
        <div class="color" style="background:#0000FF;"></div>
        <div class="color" style="background:#FFFF00;"></div>
        <div class="color" style="background:#FF00FF;"></div>
        <div class="color" style="background:#00FFFF;"></div>
        <div class="color" style="background:#FFFFFF;"></div>
        <button id="close-colors" style="width:100%;margin-top:8px;padding:6px;background:#0078d7;color:white;border:none;border-radius:4px;">
            –ó–∞–∫—Ä—ã—Ç—å
        </button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let startX = 0;
        let startY = 0;
        let currentColor = '#000000';
        let currentSize = 5;
        let currentTool = 'brush';
        let tempCanvas = document.createElement('canvas');
        let tempCtx = tempCanvas.getContext('2d');

        // –†–∞–∑–º–µ—Ä—ã —Ö–æ–ª—Å—Ç–∞
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - 80;
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // –¶–≤–µ—Ç–∞
        document.getElementById('color-btn').style.background = currentColor;
        document.getElementById('color-btn').onclick = () => {
            document.getElementById('color-panel').style.display = 'flex';
        };
        
        document.getElementById('close-colors').onclick = () => {
            document.getElementById('color-panel').style.display = 'none';
        };
        
        document.querySelectorAll('.color').forEach(color => {
            color.onclick = function() {
                currentColor = this.style.background;
                document.getElementById('color-btn').style.background = currentColor;
                document.getElementById('color-panel').style.display = 'none';
            };
        });

        // –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏
        document.getElementById('size-slider').oninput = function() {
            currentSize = this.value;
        };

        // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
            ctx.globalCompositeOperation = 'source-over';
        }

        document.getElementById('brush-btn').onclick = () => setTool('brush');
        document.getElementById('eraser-btn').onclick = () => setTool('eraser');
        document.getElementById('line-btn').onclick = () => setTool('line');
        document.getElementById('rect-btn').onclick = () => setTool('rect');
        document.getElementById('circle-btn').onclick = () => setTool('circle');
        document.getElementById('clear-btn').onclick = () => {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            }
        };

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        function startDraw(e) {
            isDrawing = true;
            const pos = getPosition(e);
            [lastX, lastY] = [startX, startY] = pos;
            
            if (currentTool === 'brush' || currentTool === 'eraser') {
                // –î–ª—è –∫–∏—Å—Ç–∏ –∏ –ª–∞—Å—Ç–∏–∫–∞ —Å—Ä–∞–∑—É —Ä–∏—Å—É–µ–º —Ç–æ—á–∫—É
                ctx.beginPath();
                ctx.arc(lastX, lastY, currentSize/2, 0, Math.PI*2);
                ctx.fillStyle = currentTool === 'eraser' ? 'white' : currentColor;
                ctx.globalCompositeOperation = currentTool === 'eraser' ? 'destination-out' : 'source-over';
                ctx.fill();
            } else {
                // –î–ª—è —Ñ–∏–≥—É—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞
                tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(canvas, 0, 0);
            }
        }

        function drawing(e) {
            if (!isDrawing) return;
            const pos = getPosition(e);
            
            if (currentTool === 'brush' || currentTool === 'eraser') {
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∏—Å—Ç–∏/–ª–∞—Å—Ç–∏–∫–∞
                ctx.lineWidth = currentSize;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                ctx.strokeStyle = currentTool === 'eraser' ? 'white' : currentColor;
                ctx.globalCompositeOperation = currentTool === 'eraser' ? 'destination-out' : 'source-over';
                
                // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(pos[0], pos[1]);
                ctx.stroke();
                
                [lastX, lastY] = pos;
            } else {
                // –î–ª—è —Ñ–∏–≥—É—Ä - –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(tempCanvas, 0, 0);
                
                ctx.lineWidth = currentSize;
                ctx.strokeStyle = currentColor;
                ctx.globalCompositeOperation = 'source-over';
                
                switch(currentTool) {
                    case 'line':
                        ctx.beginPath();
                        ctx.moveTo(startX, startY);
                        ctx.lineTo(pos[0], pos[1]);
                        ctx.stroke();
                        break;
                        
                    case 'rect':
                        ctx.beginPath();
                        ctx.rect(startX, startY, pos[0]-startX, pos[1]-startY);
                        ctx.stroke();
                        break;
                        
                    case 'circle':
                        const radius = Math.sqrt(Math.pow(pos[0]-startX, 2) + Math.pow(pos[1]-startY, 2));
                        ctx.beginPath();
                        ctx.arc(startX, startY, radius, 0, Math.PI*2);
                        ctx.stroke();
                        break;
                }
            }
        }

        function endDraw() {
            if (!isDrawing) return;
            isDrawing = false;
            
            // –§–∏–∫—Å–∏—Ä—É–µ–º —Ñ–∏–≥—É—Ä—ã –Ω–∞ —Ö–æ–ª—Å—Ç–µ
            if (currentTool !== 'brush' && currentTool !== 'eraser') {
                tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(canvas, 0, 0);
            }
        }

        function getPosition(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX || e.touches[0].clientX;
            const y = e.clientY || e.touches[0].clientY;
            return [x - rect.left, y - rect.top];
        }

        // –°–æ–±—ã—Ç–∏—è
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', drawing);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mouseout', endDraw);
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startDraw(e.touches[0]);
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            drawing(e.touches[0]);
        });
        
        canvas.addEventListener('touchend', endDraw);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        tempCtx.fillStyle = 'white';
        tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
    </script>
</body>
</html>